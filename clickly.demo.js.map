{"version":3,"sources":["webpack:///clickly.demo.js","webpack:///webpack/bootstrap 7cf1d74031d6d0319326","webpack:///./src/utils.js","webpack:///./src/iframer.js","webpack:///./src/demo.js"],"names":["clickly","modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","value","addDays","getTrackingId","document","querySelector","getAttribute","getClientId","window","cookie","split","map","trim","find","indexOf","parseInt","replace","shift","getDebug","localStorage","getItem","date","days","result","Date","setDate","getDate","buildQueryString","dateDaysAgo","dateToAnalyticsFormat","toISOString","dateFromAnalyticsFormat","str","obj","keys","k","encodeURIComponent","join","getNodeSelectorString","node","tagName","toLowerCase","id","className","traverseUp","items","push","parentNode","reverse","getNodeSelector","getNodeText","txt","innerText","length","substring","getPageType","location","pathname","querySelectorAll","inIframe","self","top","e","capturer","buildCollector","tid","cid","debug","event","data","v","t","cd1","cd2","now","cd3","Math","random","toString","cd4","ec","ea","target","el","title","url","navigator","sendBeacon","fetch","console","table","buildIFramerStylesheet","style","createElement","preventDefault","stopPropagation","type","forEach","classList","remove","iframer","click","parent","postMessage","log","mode","body","add","load","eventAction","addEventListener","removeEventListener","highlight","isIframerEvent","action","initMessageBroadcaster","frame","contentWindow","payload","arguments","undefined","onMessage","cb","default","_defineProperty","key","writable","handleClick","handleResponseData","totalClicks","totalUsers","countEvents","getUsersFor","getLabelsFor","retrieveEventsForPageType","viewId","_utils","_iframer","_iframer2","setTimeout","msg","Promise","resolve","reject","gapi","client","request","path","root","method","reportRequests","pageSize","dateRanges","startDate","endDate","metrics","expression","dimensions","filtersExpression","then","response","reports","rows","row","ts","filter","item","isNaN","sort","a","b","_ref","reduce","acc","x","label","count","_ref2","events","_ref3","JSON","stringify","assign","parse","labels","users","firstAfterView","lastAfterView","pop","firstClicksAfterView","getElementById","innerHTML","_ref4","slice","_ref5","toFixed","rows2","_ref6","_ref7","table2","_ref8","values","_ref9","prev","_ref10","next","_ref11","_ref12","_ref13","_ref14","_ref15"],"mappings":"AAAA,GAAIA,SAAUA,WAAeA,SAAc,KAClC,SAAUC,GCGnB,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAE,OAGA,IAAAC,GAAAF,EAAAD,IACAI,EAAAJ,EACAK,GAAA,EACAH,WAUA,OANAJ,GAAAE,GAAAM,KAAAH,EAAAD,QAAAC,IAAAD,QAAAH,GAGAI,EAAAE,GAAA,EAGAF,EAAAD,QAvBA,GAAAD,KA4DA,OAhCAF,GAAAQ,EAAAT,EAGAC,EAAAS,EAAAP,EAGAF,EAAAU,EAAA,SAAAP,EAAAQ,EAAAC,GACAZ,EAAAa,EAAAV,EAAAQ,IACAG,OAAAC,eAAAZ,EAAAQ,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAZ,EAAAmB,EAAA,SAAAf,GACA,GAAAQ,GAAAR,KAAAgB,WACA,WAA2B,MAAAhB,GAAA,SAC3B,WAAiC,MAAAA,GAEjC,OADAJ,GAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAQ,EAAAC,GAAsD,MAAAR,QAAAS,UAAAC,eAAAjB,KAAAc,EAAAC,IAGtDtB,EAAAyB,EAAA,GAGAzB,IAAA0B,EAAA,KDOM,SAAUtB,EAAQD,EAASH,GAEjC,YAGAc,QAAOC,eAAeZ,EAAS,cAC3BwB,OAAO,GE1EJ,IAYMC,IAZAC,gBAAgB,iBAAMC,UAASC,cAAc,4BAA4BC,aAAa,qBAEtFC,cAAc,WACvB,GAAIN,GAAQO,OAAOJ,SAASK,OACvBC,MAAM,KACNC,IAAI,SAAA5B,GAAA,MAAKA,GAAE6B,SACXC,KAAK,SAAA9B,GAAA,MAA2B,KAAtBA,EAAE+B,QAAQ,SACzB,OAAOb,GAAQc,SAASd,EAAMe,QAAQ,iBAAkB,IAAIN,MAAM,KAAKO,SAAW,MAGzEC,WAAW,mBAAQC,aAAaC,QAAQ,UAExClB,UAAU,SAACmB,EAAMC,GAC1B,GAAMC,GAAS,GAAIC,MAAKH,EAExB,OADAE,GAAOE,QAAQF,EAAOG,UAAYJ,GAC3BC,IASLI,GANOC,cAAc,SAAAN,GAAA,MAAQpB,GAAQ,GAAIsB,MAAQF,IAE1CO,wBAAwB,SAAAR,GAAA,MAAQA,GAAKS,cAAcpB,MAAM,KAAKO,SAE9Dc,0BAA0B,SAAAC,GAAA,MAAO,IAAIR,MAAKQ,EAAIhB,QAAQ,wBAAyB,cAEnE,SAAAiB,GAAA,MAAO7C,QAAO8C,KAAKD,GAAKtB,IAAI,SAAAwB,GAAA,MAAKA,GAAI,IAAMC,mBAAmBH,EAAIE,MAAKE,KAAK,OAE/FC,EAAwB,SAAAC,GAAA,MAAQA,GAAKC,QAAQC,eAAiBF,EAAKG,GAAK,IAAMH,EAAKG,GAAK,KAASH,EAAKI,UAAY,IAAMJ,EAAKI,UAAU/B,OAAOI,QAAQ,OAAQ,KAAO,KAErK4B,EAAa,SAAAL,GACf,GAAMM,KACN,IACIA,EAAMC,KAAKP,GACXA,EAAOA,EAAKQ,iBACRR,IAAkE,KAAzD,OAAQ,QAAQzB,QAAQyB,EAAKC,QAAQC,eACtD,OAAOI,GAAMG,WAGXC,EAAkB,SAAAV,GAAA,MAAQK,GAAWL,GAAM5B,IAAI2B,GAAuBD,KAAK,QAE3Ea,EAAc,SAAAX,GAChB,GAAMY,GAAMZ,GAAQA,EAAKa,UAAUxC,QAAU2B,EAAKjC,aAAa,QAAUiC,EAAKjC,aAAa,UAAYiC,GAAQA,EAAKtC,OAAS,EAC7H,OAAOkD,GAAIE,OAAS,IAAMF,EAAIG,UAAU,EAAG,KAAO,MAAQH,GAGxDI,EAAc,WAChB,MAAiC,MAA7B/C,OAAOgD,SAASC,SAAyB,OACpCrD,SAASsD,iBAAiB,oBAAoBL,OAAS,EAAU,WACjEjD,SAASsD,iBAAiB,iBAAiBL,OAAS,GAAK7C,OAAOgD,SAASC,SAAS/C,MAAM,KAAK2C,OAAS,EAAU,WAChHjD,SAASsD,iBAAiB,4BAA4BL,OAAS,EAAU,UACtE,SAGVM,EAAW,WACb,IACI,MAAOnD,QAAOoD,OAASpD,OAAOqD,IAChC,MAAOC,GACL,OAAO,IA2CTC,GAvCOC,iBAAiB,SAACC,EAAKC,EAAKC,GAAX,MAAqB,UAAAC,GAC/C,GAAMC,IACFC,EAAG,EACHL,MACAC,IAAKA,GAAO,GACZK,EAAG,QACHC,IAAKN,GAAO,GACZO,IAAKjD,KAAKkD,MACVC,IAAKnD,KAAKkD,MAAQ,IAAME,KAAKC,SAASC,SAAS,IAAIxB,UAAU,GAC7DyB,IAAKxB,IACLyB,GAAIxE,OAAOgD,SAASsB,WACpBG,GAAIb,EAAQnB,EAAgBmB,EAAMc,QAAU,OAC5CC,GAAIf,EAAQlB,EAAYkB,EAAMc,QAAU9E,SAASgF,OAG/CC,EAAM,4CAA8C1D,EAAiB0C,EAEtEV,OACG2B,UAAUC,WACVD,UAAUC,WAAWF,GAErBG,MAAMH,IAIVlB,GACAsB,QAAQC,OAAOrB,MAIVsB,yBAAyB,WAClC,GAAMC,GAAQxF,SAASyF,cAAc,QAKrC,OAJAD,GAAMxC,UAAN,4IAIOwC,GAGM,SAAAxB,GAGb,GAFAA,EAAM0B,iBACN1B,EAAM2B,kBACa,UAAf3B,EAAM4B,KAAV,CACA5F,SAASsD,iBAAiB,qBAAqBuC,QAAQ,SAAAd,GAAA,MAAMA,GAAGe,UAAUC,OAAO,qBACjF,IAAM9B,IACF+B,SACIC,OACIrB,GAAIxE,OAAOgD,SAASsB,WACpBG,GAAIhC,EAAgBmB,EAAMc,QAC1BC,GAAIjC,EAAYkB,EAAMc,QACtBH,IAAKxB,MAIjB+C,QAAOC,YAAYlC,EAAM,OAGhB+B,WAAU,SAAAhC,GACnB,GAAKA,GAAUA,EAAMC,MAChBD,EAAMC,KAAKvE,eAAe,WAA/B,CAEA,GAAMuE,GAAOD,EAAMC,KAAK+B,OAIxB,IAFAX,QAAQe,IAAI,UAAWnC,GAEnBA,EAAKvE,eAAe,QAAS,CACX,YAAduE,EAAKoC,MACLrG,SAASsG,KAAKR,UAAUS,IAAI,WACxBL,QACAA,OAAOC,aACHH,SACIQ,MACIvB,IAAK7E,OAAOgD,SAASsB,WACrBC,IAAKxB,OAGd,MAGPnD,SAASsG,KAAKR,UAAUC,OAAO,UAEnC,IAAMU,GAA4B,YAAdxC,EAAKoC,KACnBrG,SAASsG,KAAKI,iBACd1G,SAASsG,KAAKK,mBAEpBF,GAAY,YAAa9C,GAAU,GACnC8C,EAAY,UAAW9C,GAAU,GACjC8C,EAAY,QAAS9C,GAAU,OACxBM,GAAKvE,eAAe,eAC3B2F,QAAQe,IAAR,uBAAmCnC,EAAK2C,UAAU/B,GAAlD,KAAyD7E,SAASsD,iBAAiBW,EAAK2C,UAAU/B,IAAI5B,OAAtG,eACAjD,SAASsD,iBAAiB,qBAAqBuC,QAAQ,SAAAd,GAAA,MAAMA,GAAGe,UAAUC,OAAO,sBACjF/F,SAASsD,iBAAiBW,EAAK2C,UAAU/B,IAAIgB,QAAQ,SAAAd,GAAA,MAAMA,GAAGe,UAAUS,IAAI,0BFoG9E,SAAUjI,EAAQD,EAASH,GAEjC,YAGAc,QAAOC,eAAeZ,EAAS,cAC3BwB,OAAO,GGjQX,IAAMgH,GAAiB,SAAA7C,GAAA,MAASA,IACzBA,EAAMC,MACND,EAAMC,KAAK+B,SACXhC,EAAMC,KAAK+B,QAAQc,QASbX,GAPAY,yBAAyB,iBAAM3G,QAAOsG,iBAAiB,UAAW,SAAA1C,GACtE6C,EAAe7C,IACpBhE,SAASsD,iBAAiB,SAASuC,QAAQ,SAAAmB,GACvC,MAAOA,GAAMC,cAAcd,YAAYnC,EAAMC,KAAM,SAExD,IAEUkC,cAAc,SAACW,GAAD,GAASI,GAATC,UAAAlE,OAAA,OAAAmE,KAAAD,UAAA,GAAAA,UAAA,GAAmB,IAAnB,OAA4BjB,SAAUA,OAAOC,aACpEH,SACIc,SACAI,YAEL,OAEUG,cAAY,SAACP,EAAQQ,GAAT,MAAgBlH,QAAOsG,iBAAiB,UAAW,SAAA1C,GACnE6C,EAAe7C,IAChBA,EAAMC,KAAK+B,QAAQc,SAAWA,GAClCQ,EAAGtD,EAAMC,KAAK+B,QAAQkB,WACvB,GH2QH7I,GAAQkJ,SGxQJpB,cACAkB,cH6QG,CAED,SAAU/I,EAAQD,EAASH,GAEjC,YAgBA,SAASsJ,GAAgB3F,EAAK4F,EAAK5H,GAAiK,MAApJ4H,KAAO5F,GAAO7C,OAAOC,eAAe4C,EAAK4F,GAAO5H,MAAOA,EAAOV,YAAY,EAAMD,cAAc,EAAMwI,UAAU,IAAkB7F,EAAI4F,GAAO5H,EAAgBgC,EAb3M7C,OAAOC,eAAeZ,EAAS,cAC3BwB,OAAO,IAEXxB,EAAQsJ,YAActJ,EAAQ4H,MAAQ5H,EAAQuI,UAAYvI,EAAQuJ,mBAAqBvJ,EAAQwJ,YAAcxJ,EAAQyJ,WAAazJ,EAAQ0J,YAAc1J,EAAQ2J,YAAc3J,EAAQ4J,aAAe5J,EAAQ6J,0BAA4B7J,EAAQ8J,WAASf,EIlT1P,IAAAgB,GAAAlK,EAAA,GACAmK,EAAAnK,EAAA,GJuTIoK,EAEJ,SAAgCzG,GAAO,MAAOA,IAAOA,EAAIvC,WAAauC,GAAQ0F,QAAS1F,IAFhDwG,EIrTvCE,YAAW,WACXD,EAAAf,QAAQpB,YAAY,SACjB,KACHmC,EAAAf,QAAQF,UAAU,OAAQ,SAAAmB,GACtBnD,QAAQe,IAAI,+BAAgCoC,IAGzC,IAAML,YAAS,YA+CTF,GA7CAC,4BAA4B,cAACtC,GAADuB,UAAAlE,OAAA,OAAAmE,KAAAD,UAAA,GAAAA,UAAA,GAAQ,MAAR,OAAmB,IAAIsB,SAAQ,SAACC,EAASC,GAE9EC,KAAKC,OAAOC,SACRC,KAAM,uBACNC,KAAM,6CACNC,OAAQ,OACR3C,MACI4C,iBACIC,SAAU,IACVhB,SACAiB,aAGIC,WAAW,EAAAjB,EAAA3G,wBAAsB,EAAA2G,EAAA5G,cAAa,IAC9C8H,SAAS,EAAAlB,EAAA3G,wBAAsB,EAAA2G,EAAA5G,aAAY,MAE/C+H,UACIC,WAAY,mBAEhBC,aACK5K,KAAM,qBACNA,KAAM,mBACNA,KAAM,kBACNA,KAAM,kBACNA,KAAM,kBAEX6K,oCAAqC9D,EAArC,mCAER+D,KAAK,SAAAC,GACL,GAAM3F,GAAO2F,EAASzI,OAAO0I,QAAQ,GAAG5F,KAAK6F,KACxCvJ,IAAI,SAAAwJ,GAAA,OACDnF,GAAImF,EAAIN,WAAW,GACnB5E,GAAIkF,EAAIN,WAAW,GACnB1E,GAAIgF,EAAIN,WAAW,GACnB3F,IAAKnD,SAASoJ,EAAIN,WAAW,IAC7BO,GAAIrJ,SAASoJ,EAAIN,WAAW,OAE/BQ,OAAO,SAAAC,GAAA,OAASC,MAAMD,EAAKpG,OAC3BsG,KAAK,SAACC,EAAGC,GAAJ,MAAUD,GAAEL,GAAKM,EAAEN,IAE7B5J,QAAO6D,KAAOA,EACdyE,EAAQzE,IACT0E,MAGMV,eAAe,SAAChE,EAADsG,GAAA,GAAgB1F,GAAhB0F,EAAgB1F,EAAhB,OAAwBZ,GAC/CgG,OAAO,SAAAC,GAAA,MAA8BA,GAAKrF,KAAOA,IACjDtE,IAAI,SAAA2J,GAAA,MAAQA,GAAKnF,KACjByF,OAAO,SAACC,EAAKC,GAIV,OAHwB,IAApBD,EAAI/J,QAAQgK,IACZD,EAAI/H,KAAKgI,GAEND,OAEVlK,IAAI,SAAAoK,GAAA,OACDA,QACAC,MAAO3G,EAAKgG,OAAO,SAAA1L,GAAA,MAAKA,GAAEwG,KAAO4F,IAAO1H,UAE3CmH,KAAK,SAACC,EAAGC,GAAJ,MAAUA,GAAEM,MAAQP,EAAEO,UAEnB5C,gBAAc,SAAC/D,EAAD4G,GAAA,GAAgBhG,GAAhBgG,EAAgBhG,EAAhB,OAAwBZ,GAC9CgG,OAAO,SAAAC,GAAA,MAA8BA,GAAKrF,KAAOA,IACjDtE,IAAI,SAAA2J,GAAA,MAAQA,GAAKpG,MACjB0G,OAAO,SAACC,EAAKC,GAIV,OAHwB,IAApBD,EAAI/J,QAAQgK,IACZD,EAAI/H,KAAKgI,GAEND,OAEVxH,QAEQ8E,gBAAc,SAAA9D,GACvB,GAAM6G,GAAS7G,EAGV1D,IAAI,SAAAwK,GAAA,OAAYlG,GAAZkG,EAAElG,MACN2F,OAAO,SAACC,EAAKC,GACV,GAAMjD,GAAMuD,KAAKC,UAAUP,EAE3B,OADAD,GAAIhD,IAAQgD,EAAIhD,IAAQ,GAAK,EACtBgD,MAEf,OAAOzL,QAAO8C,KAAKgJ,GAEdvK,IAAI,SAAAkH,GAAA,MAAOzI,QAAOkM,OAAOF,KAAKG,MAAM1D,IACjCmD,MAAOE,EAAOrD,GACd2D,OAAQnD,EAAahE,EAAM+G,KAAKG,MAAM1D,IACtC4D,MAAOrD,EAAY/D,EAAM+G,KAAKG,MAAM1D,QAEvC2C,KAAK,SAACC,EAAGC,GAAJ,MAAUA,GAAEM,MAAQP,EAAEO,SAGzB9C,eAAa,EACbD,gBAAc,EA6FZF,GA3FAC,qBAAqB,SAAA3D,GAC9B,GAAMqH,GAAiBrH,EAClBgG,OAAO,SAAA1L,GAAA,MAAc,SAATA,EAAEsG,KACdtE,IAAI,SAAA5B,GAAA,MAAKsF,GAAKgG,OAAO,SAAA1L,GAAA,MAAKI,GAAEmF,MAAQvF,EAAEuF,KAAOnF,EAAEqL,GAAKzL,EAAEyL,KAAII,KAAK,SAACC,EAAGC,GAAJ,MAAUD,GAAEL,GAAKM,EAAEN,KAAInJ,UAErF0K,EAAgBtH,EACjBgG,OAAO,SAAA1L,GAAA,MAAc,SAATA,EAAEsG,KACdtE,IAAI,SAAA5B,GAAA,MAAKsF,GAAKgG,OAAO,SAAA1L,GAAA,MAAKI,GAAEmF,MAAQvF,EAAEuF,KAAOnF,EAAEqL,GAAKzL,EAAEyL,KAAII,KAAK,SAACC,EAAGC,GAAJ,MAAUD,GAAEL,GAAKM,EAAEN,KAAIwB,QACtFvB,OAAO,SAAAtL,GAAA,QAAOA,IAGb8M,EAAuBH,EAAerB,OAAO,SAAAtL,GAAA,QAAOA,GAE1DN,GAhBOyJ,WAgBPA,EAAa7D,EAAK1D,IAAI,SAAAhC,GAAA,MAAKA,GAAEuF,MAAK0G,OAAO,SAACC,EAAKC,GAI3C,OAHwB,IAApBD,EAAI/J,QAAQgK,IACZD,EAAI/H,KAAKgI,GAEND,OACJxH,OAEP5E,EAtBOwJ,YAsBPA,EAAc5D,EAAKgG,OAAO,SAAA1L,GAAA,MAAc,SAATA,EAAEsG,KAAe5B,OAE5CjD,SAAS0L,eAAe,UACxB1L,SAAS0L,eAAe,QAAQC,UAAhC,yBACU7D,EADV,gCAEU7D,EAAKhB,OAFf,iCAGUgB,EAAKgG,OAAO,SAAA1L,GAAA,MAAc,SAATA,EAAEsG,KAAe5B,OAH5C,oCAIU4E,EAJV,kCAKU4D,EAAqBxI,OAL/B,wCAMUqI,EAAerI,OAASwI,EAAqBxI,QANvD,6BAUJ,IAAM6H,GAAS/C,EAAY0D,GACrB3B,EAAOgB,EACRb,OAAO,SAAA2B,GAAA,MAAiB,SAAjBA,EAAE/G,KACTgH,MAAM,EAAG,IACTtL,IAAI,SAAAuL,GAAA,GAAEjH,GAAFiH,EAAEjH,GAAIuG,EAANU,EAAMV,OAAQR,EAAdkB,EAAclB,MAAOS,EAArBS,EAAqBT,KAArB,oCAA6DxG,EAA7D,8CAA4GA,EAA5G,gEAA4KA,EAA5K,2CAAwNuG,EAAO7K,IAAI,SAAAmK,GAAA,aAAYA,EAAEC,MAAd,KAAwBD,EAAEE,MAA1B,WAAnO,kCAA6SA,EAA7S,MAAwTA,EAAM/C,EAAY,KAAKkE,QAAQ,GAAvV,cAAuWV,EAAvW,MAAkXA,EAAMvD,EAAW,KAAKiE,QAAQ,GAAhZ,iBACJ9J,KAAK,IAEJqD,0TASOwE,EATP,yBAaAkC,EAAQjE,EAAYwD,GACrBtB,OAAO,SAAAgC,GAAA,MAAiB,SAAjBA,EAAEpH,KACTgH,MAAM,EAAG,IACTtL,IAAI,SAAA2L,GAAA,GAAErH,GAAFqH,EAAErH,GAAIuG,EAANc,EAAMd,OAAQR,EAAdsB,EAActB,MAAOS,EAArBa,EAAqBb,KAArB,oCAA6DxG,EAA7D,8CAA4GA,EAA5G,gEAA4KA,EAA5K,2CAAwNuG,EAAO7K,IAAI,SAAAmK,GAAA,aAAYA,EAAEC,MAAd,KAAwBD,EAAEE,MAA1B,WAAnO,kCAA6SA,EAA7S,MAAwTA,EAAM/C,EAAY,KAAKkE,QAAQ,GAAvV,cAAuWV,EAAvW,MAAkXA,EAAMvD,EAAW,KAAKiE,QAAQ,GAAhZ,iBACJ9J,KAAK,IAEJkK,yTASOH,EATP,wBAYFhM,UAAS0L,eAAe,eACxB1L,SAAS0L,eAAe,aAAaC,UAAYrG,EAAQ6G,IAIpDvF,YAAY,SAAA/B,GACrB,GAAMZ,IACF+B,SACIY,WACI/B,OAIZqB,QAAOC,YAAYlC,EAAM,MAGhBgC,QAAQ,SAAApB,GACjB8C,EAAY1D,MAAOY,QAGV8C,cAAc,SAAC1D,EAAMgC,GAC9B,GAAM6E,GAAS7G,EAAKgG,OAAO,SAAAmC,GAAA,MAAmC,KAAnCA,EAAEvH,GAAWnE,QAAQuF,EAAMpB,MAChDwG,EAAQrM,OAAOqN,OAAOvB,EAAOvK,IAAI,SAAA+L,GAAA,MAAAA,GAAExI,MAAc0G,OAAO,SAACC,EAAKC,GAAN,MAAY1L,QAAOkM,OAAOT,EAAdjD,KAAqBkD,EAAIA,UAC7FjI,EAAQqI,EAAOvK,IAAI,SAAAyD,GAGrB,MAFAA,GAAMuI,KAAOtI,EAAKgG,OAAO,SAAAuC,GAAA,GAAE1I,GAAF0I,EAAE1I,IAAKkG,EAAPwC,EAAOxC,EAAP,OAAehG,GAAMF,MAAQA,GAAOE,EAAMgG,GAAKA,IAAII,KAAK,SAACC,EAAGC,GAAJ,MAAUD,GAAEL,GAAKM,EAAEN,KAAIwB,QAAU5G,GAAI,OAAQC,GAAI,OAAQE,GAAI,OAAQjB,IAAKE,EAAMF,IAAKkG,GAAIhG,EAAMgG,GAAK,GACrLhG,EAAMyI,KAAOxI,EAAKgG,OAAO,SAAAyC,GAAA,GAAE5I,GAAF4I,EAAE5I,IAAKkG,EAAP0C,EAAO1C,EAAP,OAAehG,GAAMF,MAAQA,GAAOE,EAAMgG,GAAKA,IAAII,KAAK,SAACC,EAAGC,GAAJ,MAAUD,GAAEL,GAAKM,EAAEN,KAAInJ,UAAY+D,GAAI,OAAQC,GAAI,OAAQE,GAAI,OAAQjB,IAAKE,EAAMF,IAAKkG,GAAIhG,EAAMgG,GAAK,GAChLhG,GAEX5D,QAAOqC,MAAQA,CAEf,IAAM8J,GAAOxE,EAAYtF,EAAMlC,IAAI,SAAAoM,GAAA,MAAAA,GAAEJ,QAC/BE,EAAO1E,EAAYtF,EAAMlC,IAAI,SAAAqM,GAAA,MAAAA,GAAEH,OAGjCzM,UAAS0L,eAAe,UACxB1L,SAAS0L,eAAe,QAAQC,UAAhC,yBACUb,EAAO7H,OADjB,aACoC6H,EAAO7H,OAAS4E,EAAc,KAAKkE,QAAQ,GAD/E,4BAEUV,EAAMpI,OAFhB,YAEkC6H,EAAO7H,OAAS6E,EAAa,KAAKiE,QAAQ,GAF5E,yBAKA/L,SAAS0L,eAAe,QAAQC,UAAhC,qCACiBY,EAAKtJ,OADtB,iWAWasJ,EACJhM,IAAI,SAAAsM,GAAA,GAAMhI,IAANgI,EAAEjI,GAAFiI,EAAMhI,IAAIuG,EAAVyB,EAAUzB,OAAQR,EAAlBiC,EAAkBjC,MAAOS,EAAzBwB,EAAyBxB,KAAzB,oCAAiExG,EAAjE,8CAAgHA,EAAhH,gEAAgLA,EAAhL,2CAA4NuG,EAAO7K,IAAI,SAAAmK,GAAA,aAAYA,EAAEC,MAAd,KAAwBD,EAAEE,MAA1B,WAAvO,kCAAiTA,EAAjT,MAA4TA,EAAM/C,EAAY,KAAKkE,QAAQ,GAA3V,cAA2WV,EAA3W,MAAsXA,EAAMvD,EAAW,KAAKiE,QAAQ,GAApZ,iBACJ9J,KAAK,IAbd,iDAiBAjC,SAAS0L,eAAe,QAAQC,UAAhC,qCACiBc,EAAKxJ,OADtB,6TAWSsJ,EACJhM,IAAI,SAAAuM,GAAA,GAAMjI,IAANiI,EAAElI,GAAFkI,EAAMjI,IAAIuG,EAAV0B,EAAU1B,OAAQR,EAAlBkC,EAAkBlC,MAAOS,EAAzByB,EAAyBzB,KAAzB,oCAAiExG,EAAjE,8CAAgHA,EAAhH,gEAAgLA,EAAhL,2CAA4NuG,EAAO7K,IAAI,SAAAmK,GAAA,aAAYA,EAAEC,MAAd,KAAwBD,EAAEE,MAA1B,WAAvO,kCAAiTA,EAAjT,MAA4TA,EAAM/C,EAAY,KAAKkE,QAAQ,GAA3V,cAA2WV,EAA3W,MAAsXA,EAAMvD,EAAW,KAAKiE,QAAQ,GAApZ,iBACJ9J,KAAK,IAbV","file":"clickly.demo.js","sourcesContent":["var clickly = clickly || {}; clickly[\"demo\"] =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 3);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar getTrackingId = exports.getTrackingId = function getTrackingId() {\n    return document.querySelector('script[data-clickly-tid]').getAttribute('data-clickly-tid');\n};\n\nvar getClientId = exports.getClientId = function getClientId() {\n    var value = window.document.cookie.split(';').map(function (c) {\n        return c.trim();\n    }).find(function (c) {\n        return c.indexOf('_ga=') === 0;\n    });\n    return value ? parseInt(value.replace(/_ga=GA\\d\\.\\d\\./, '').split('.').shift()) : null;\n};\n\nvar getDebug = exports.getDebug = function getDebug() {\n    return !!localStorage.getItem('debug');\n};\n\nvar addDays = exports.addDays = function addDays(date, days) {\n    var result = new Date(date);\n    result.setDate(result.getDate() + days);\n    return result;\n};\n\nvar dateDaysAgo = exports.dateDaysAgo = function dateDaysAgo(days) {\n    return addDays(new Date(), days);\n};\n\nvar dateToAnalyticsFormat = exports.dateToAnalyticsFormat = function dateToAnalyticsFormat(date) {\n    return date.toISOString().split('T').shift();\n};\n\nvar dateFromAnalyticsFormat = exports.dateFromAnalyticsFormat = function dateFromAnalyticsFormat(str) {\n    return new Date(str.replace(/(\\d{4})(\\d{2})(\\d{2})/, '$1-$2-$3'));\n};\n\nvar buildQueryString = function buildQueryString(obj) {\n    return Object.keys(obj).map(function (k) {\n        return k + '=' + encodeURIComponent(obj[k]);\n    }).join('&');\n};\n\nvar getNodeSelectorString = function getNodeSelectorString(node) {\n    return node.tagName.toLowerCase() + (node.id ? '#' + node.id : '') + (!!node.className ? '.' + node.className.trim().replace(/\\s+/g, '.') : '');\n};\n\nvar traverseUp = function traverseUp(node) {\n    var items = [];\n    do {\n        items.push(node);\n        node = node.parentNode;\n    } while (node && ['html', 'body'].indexOf(node.tagName.toLowerCase()) === -1);\n    return items.reverse();\n};\n\nvar getNodeSelector = function getNodeSelector(node) {\n    return traverseUp(node).map(getNodeSelectorString).join(' > ');\n};\n\nvar getNodeText = function getNodeText(node) {\n    var txt = node && node.innerText.trim() || node.getAttribute('alt') || node.getAttribute('title') || node && node.value || '';\n    return txt.length > 250 ? txt.substring(0, 247) + '...' : txt;\n};\n\nvar getPageType = function getPageType() {\n    if (window.location.pathname === '/') return 'home';else if (document.querySelectorAll('.subcategoryName').length > 0) return 'category';else if (document.querySelectorAll('.product-grid').length > 0 && window.location.pathname.split('/').length > 3) return 'products';else if (document.querySelectorAll('input[name=\"product_id\"]').length > 0) return 'product';else return 'other';\n};\n\nvar inIframe = function inIframe() {\n    try {\n        return window.self !== window.top;\n    } catch (e) {\n        return true;\n    }\n};\n\nvar buildCollector = exports.buildCollector = function buildCollector(tid, cid, debug) {\n    return function (event) {\n        var data = {\n            v: 1,\n            tid: tid,\n            cid: cid || '',\n            t: 'event',\n            cd1: cid || '',\n            cd2: Date.now(),\n            cd3: Date.now() + '.' + Math.random().toString(36).substring(5),\n            cd4: getPageType(),\n            ec: window.location.toString(),\n            ea: event ? getNodeSelector(event.target) : 'view',\n            el: event ? getNodeText(event.target) : document.title\n        };\n\n        var url = 'https://www.google-analytics.com/collect?' + buildQueryString(data);\n\n        if (!inIframe()) {\n            if (navigator.sendBeacon) {\n                navigator.sendBeacon(url);\n            } else {\n                fetch(url);\n            }\n        }\n\n        if (debug) {\n            console.table([data]);\n        }\n    };\n};\n\nvar buildIFramerStylesheet = exports.buildIFramerStylesheet = function buildIFramerStylesheet() {\n    var style = document.createElement('style');\n    style.innerText = '\\n    body.capture *:hover {outline: 2px solid blue}\\n    .clicklyhighlight {outline: 2px solid red;box-shadow:inset 0 0 0 2px red}\\n    ';\n    return style;\n};\n\nvar capturer = function capturer(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (event.type !== 'click') return;\n    document.querySelectorAll('.clicklyhighlight').forEach(function (el) {\n        return el.classList.remove('clicklyhighlight');\n    });\n    var data = {\n        iframer: {\n            click: {\n                ec: window.location.toString(),\n                ea: getNodeSelector(event.target),\n                el: getNodeText(event.target),\n                cd4: getPageType()\n            }\n        }\n    };\n    parent.postMessage(data, '*');\n};\n\nvar iframer = exports.iframer = function iframer(event) {\n    if (!event || !event.data) return;\n    if (!event.data.hasOwnProperty('iframer')) return;\n\n    var data = event.data.iframer;\n\n    console.log('MESSAGE', data);\n\n    if (data.hasOwnProperty('mode')) {\n        if (data.mode === 'capture') {\n            document.body.classList.add('capture');\n            if (parent) {\n                parent.postMessage({\n                    iframer: {\n                        load: {\n                            url: window.location.toString(),\n                            cd4: getPageType()\n                        }\n                    }\n                }, '*');\n            }\n        } else {\n            document.body.classList.remove('capture');\n        }\n        var eventAction = data.mode === 'capture' ? document.body.addEventListener : document.body.removeEventListener;\n\n        eventAction('mousedown', capturer, true);\n        eventAction('mouseup', capturer, true);\n        eventAction('click', capturer, true);\n    } else if (data.hasOwnProperty('highlight')) {\n        console.log('going to highlight \"' + data.highlight.ea + '\" ' + document.querySelectorAll(data.highlight.ea).length + ' element(s)');\n        document.querySelectorAll('.clicklyhighlight').forEach(function (el) {\n            return el.classList.remove('clicklyhighlight');\n        });\n        document.querySelectorAll(data.highlight.ea).forEach(function (el) {\n            return el.classList.add('clicklyhighlight');\n        });\n    }\n};\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar isIframerEvent = function isIframerEvent(event) {\n    return event && event.data && event.data.iframer && event.data.iframer.action;\n};\n\nvar initMessageBroadcaster = exports.initMessageBroadcaster = function initMessageBroadcaster() {\n    return window.addEventListener('message', function (event) {\n        if (!isIframerEvent(event)) return;\n        document.querySelectorAll('frame').forEach(function (frame) {\n            return frame.contentWindow.postMessage(event.data, '*');\n        });\n    }, false);\n};\n\nvar postMessage = exports.postMessage = function postMessage(action) {\n    var payload = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    return parent && parent.postMessage({\n        iframer: {\n            action: action,\n            payload: payload\n        }\n    }, '*');\n};\n\nvar onMessage = exports.onMessage = function onMessage(action, cb) {\n    return window.addEventListener('message', function (event) {\n        if (!isIframerEvent(event)) return;\n        if (event.data.iframer.action !== action) return;\n        cb(event.data.iframer.payload);\n    }, false);\n};\n\nexports.default = {\n    postMessage: postMessage,\n    onMessage: onMessage\n};\n\n/***/ }),\n/* 2 */,\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.handleClick = exports.click = exports.highlight = exports.handleResponseData = exports.totalClicks = exports.totalUsers = exports.countEvents = exports.getUsersFor = exports.getLabelsFor = exports.retrieveEventsForPageType = exports.viewId = undefined;\n\nvar _utils = __webpack_require__(0);\n\nvar _iframer = __webpack_require__(1);\n\nvar _iframer2 = _interopRequireDefault(_iframer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nsetTimeout(function () {\n    _iframer2.default.postMessage('ping');\n}, 1000);\n_iframer2.default.onMessage('pong', function (msg) {\n    console.log('NEW IFRAMER GOT pong MESSAGE', msg);\n});\n\nvar viewId = exports.viewId = '160451249';\n\nvar retrieveEventsForPageType = exports.retrieveEventsForPageType = function retrieveEventsForPageType() {\n    var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'home';\n    return new Promise(function (resolve, reject) {\n        var daysAgo = 1;\n        gapi.client.request({\n            path: '/v4/reports:batchGet',\n            root: 'https://analyticsreporting.googleapis.com/',\n            method: 'POST',\n            body: {\n                reportRequests: [{\n                    pageSize: 10000,\n                    viewId: viewId,\n                    dateRanges: [{\n                        // startDate: dateToAnalyticsFormat(dateDaysAgo(-1 * daysAgo)),\n                        // endDate: dateToAnalyticsFormat(dateDaysAgo(-1 * daysAgo))\n                        startDate: (0, _utils.dateToAnalyticsFormat)((0, _utils.dateDaysAgo)(-8)),\n                        endDate: (0, _utils.dateToAnalyticsFormat)((0, _utils.dateDaysAgo)(0))\n                    }],\n                    metrics: [{\n                        expression: 'ga:totalEvents'\n                    }],\n                    dimensions: [{ name: 'ga:eventCategory' }, { name: 'ga:eventAction' }, { name: 'ga:eventLabel' }, { name: 'ga:dimension1' }, { name: 'ga:dimension2' }],\n                    filtersExpression: 'ga:dimension4==' + type + ';ga:deviceCategory==desktop'\n                }]\n            } }).then(function (response) {\n            var data = response.result.reports[0].data.rows.map(function (row) {\n                return {\n                    ec: row.dimensions[0],\n                    ea: row.dimensions[1],\n                    el: row.dimensions[2],\n                    cid: parseInt(row.dimensions[3]),\n                    ts: parseInt(row.dimensions[4])\n                };\n            }).filter(function (item) {\n                return !isNaN(item.cid);\n            }).sort(function (a, b) {\n                return a.ts - b.ts;\n            });\n\n            window.data = data;\n            resolve(data);\n        }, reject);\n    });\n};\n\nvar getLabelsFor = exports.getLabelsFor = function getLabelsFor(data, _ref) {\n    var ea = _ref.ea;\n    return data.filter(function (item) {\n        return (/*item.ec === ec &&*/item.ea === ea\n        );\n    }).map(function (item) {\n        return item.el;\n    }).reduce(function (acc, x) {\n        if (acc.indexOf(x) === -1) {\n            acc.push(x);\n        }\n        return acc;\n    }, []).map(function (label) {\n        return {\n            label: label,\n            count: data.filter(function (i) {\n                return i.el === label;\n            }).length\n        };\n    }).sort(function (a, b) {\n        return b.count - a.count;\n    });\n};\n\nvar getUsersFor = exports.getUsersFor = function getUsersFor(data, _ref2) {\n    var ea = _ref2.ea;\n    return data.filter(function (item) {\n        return (/*item.ec === ec &&*/item.ea === ea\n        );\n    }).map(function (item) {\n        return item.cid;\n    }).reduce(function (acc, x) {\n        if (acc.indexOf(x) === -1) {\n            acc.push(x);\n        }\n        return acc;\n    }, []).length;\n};\n\nvar countEvents = exports.countEvents = function countEvents(data) {\n    var events = data\n    //.map(({ec, ea, el}) => ({ec, ea, el}))\n    //.map(({ec, ea}) => ({ec, ea}))\n    .map(function (_ref3) {\n        var ea = _ref3.ea;\n        return { ea: ea };\n    }).reduce(function (acc, x) {\n        var key = JSON.stringify(x);\n        acc[key] = (acc[key] || 0) + 1;\n        return acc;\n    }, {});\n    return Object.keys(events)\n    //.map(key => Object.assign(JSON.parse(key), {count: events[key]}))\n    .map(function (key) {\n        return Object.assign(JSON.parse(key), {\n            count: events[key],\n            labels: getLabelsFor(data, JSON.parse(key)),\n            users: getUsersFor(data, JSON.parse(key))\n        });\n    }).sort(function (a, b) {\n        return b.count - a.count;\n    });\n};\n\nvar totalUsers = exports.totalUsers = 0;\nvar totalClicks = exports.totalClicks = 0;\n\nvar handleResponseData = exports.handleResponseData = function handleResponseData(data) {\n    var firstAfterView = data.filter(function (i) {\n        return i.ea === 'view';\n    }).map(function (c) {\n        return data.filter(function (i) {\n            return c.cid === i.cid && c.ts < i.ts;\n        }).sort(function (a, b) {\n            return a.ts - b.ts;\n        }).shift();\n    });\n\n    var lastAfterView = data.filter(function (i) {\n        return i.ea === 'view';\n    }).map(function (c) {\n        return data.filter(function (i) {\n            return c.cid === i.cid && c.ts < i.ts;\n        }).sort(function (a, b) {\n            return a.ts - b.ts;\n        }).pop();\n    }).filter(function (c) {\n        return !!c;\n    });\n\n    var firstClicksAfterView = firstAfterView.filter(function (c) {\n        return !!c;\n    });\n\n    exports.totalUsers = totalUsers = data.map(function (i) {\n        return i.cid;\n    }).reduce(function (acc, x) {\n        if (acc.indexOf(x) === -1) {\n            acc.push(x);\n        }\n        return acc;\n    }, []).length;\n\n    exports.totalClicks = totalClicks = data.filter(function (i) {\n        return i.ea !== 'view';\n    }).length;\n\n    if (document.getElementById('info')) {\n        document.getElementById('info').innerHTML = '<ul>\\n            <li>' + totalUsers + ' users</li>\\n            <li>' + data.length + ' events</li>\\n            <li>' + data.filter(function (i) {\n            return i.ea === 'view';\n        }).length + ' pageviews</li>\\n            <li>' + totalClicks + ' clickls</li>\\n            <li>' + firstClicksAfterView.length + ' first clicks</li>\\n            <li>' + (firstAfterView.length - firstClicksAfterView.length) + ' exits</li>\\n        </ul>';\n    }\n\n    var events = countEvents(firstClicksAfterView);\n    var rows = events.filter(function (_ref4) {\n        var ea = _ref4.ea;\n        return ea !== 'view';\n    }).slice(0, 10).map(function (_ref5) {\n        var ea = _ref5.ea,\n            labels = _ref5.labels,\n            count = _ref5.count,\n            users = _ref5.users;\n        return '<tr><td><details><summary>' + ea + ' <button onclick=\"clickly.demo.highlight(\\'' + ea + '\\')\">highlight</button><button onclick=\"clickly.demo.click(\\'' + ea + '\\')\">click</button></summary><small><ul>' + labels.map(function (x) {\n            return '<li>' + x.label + ' (' + x.count + ')</li>';\n        }) + '</ul><small></details></td><td>' + count + ' (' + (count / totalClicks * 100).toFixed(2) + '%)</td><td>' + users + ' (' + (users / totalUsers * 100).toFixed(2) + '%)</td></tr>';\n    }).join('');\n\n    var table = '<table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\\n        <caption>Top first clicks after view</caption>\\n        <thead>\\n            <tr>\\n                <th>ea</th>\\n                <th>count</th>\\n                <th>users</th>\\n            </tr>\\n        <thead>\\n        <tbody>' + rows + '</tbody>\\n    </table>';\n\n    var rows2 = countEvents(lastAfterView).filter(function (_ref6) {\n        var ea = _ref6.ea;\n        return ea !== 'view';\n    }).slice(0, 10).map(function (_ref7) {\n        var ea = _ref7.ea,\n            labels = _ref7.labels,\n            count = _ref7.count,\n            users = _ref7.users;\n        return '<tr><td><details><summary>' + ea + ' <button onclick=\"clickly.demo.highlight(\\'' + ea + '\\')\">highlight</button><button onclick=\"clickly.demo.click(\\'' + ea + '\\')\">click</button></summary><small><ul>' + labels.map(function (x) {\n            return '<li>' + x.label + ' (' + x.count + ')</li>';\n        }) + '</ul><small></details></td><td>' + count + ' (' + (count / totalClicks * 100).toFixed(2) + '%)</td><td>' + users + ' (' + (users / totalUsers * 100).toFixed(2) + '%)</td></tr>';\n    }).join('');\n\n    var table2 = '<table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\\n        <caption>Top last clicks after view</caption>\\n        <thead>\\n            <tr>\\n                <th>ea</th>\\n                <th>count</th>\\n                <th>users</th>\\n            </tr>\\n        <thead>\\n        <tbody>' + rows2 + '</tbody>\\n    </table>';\n\n    if (document.getElementById('topevents')) {\n        document.getElementById('topevents').innerHTML = table + table2;\n    }\n};\n\nvar highlight = exports.highlight = function highlight(ea) {\n    var data = {\n        iframer: {\n            highlight: {\n                ea: ea\n            }\n        }\n    };\n    parent.postMessage(data, '*');\n};\n\nvar click = exports.click = function click(ea) {\n    handleClick(data, { ea: ea });\n};\n\nvar handleClick = exports.handleClick = function handleClick(data, click) {\n    var events = data.filter(function (_ref8) {\n        var ea = _ref8.ea;\n        return ea.indexOf(click.ea) === 0;\n    });\n    var users = Object.values(events.map(function (_ref9) {\n        var cid = _ref9.cid;\n        return cid;\n    }).reduce(function (acc, x) {\n        return Object.assign(acc, _defineProperty({}, x, x));\n    }, {}));\n    var items = events.map(function (event) {\n        event.prev = data.filter(function (_ref10) {\n            var cid = _ref10.cid,\n                ts = _ref10.ts;\n            return event.cid === cid && event.ts > ts;\n        }).sort(function (a, b) {\n            return a.ts - b.ts;\n        }).pop() || { ec: 'exit', ea: 'exit', el: 'exit', cid: event.cid, ts: event.ts + 1 };\n        event.next = data.filter(function (_ref11) {\n            var cid = _ref11.cid,\n                ts = _ref11.ts;\n            return event.cid === cid && event.ts < ts;\n        }).sort(function (a, b) {\n            return a.ts - b.ts;\n        }).shift() || { ec: 'exit', ea: 'exit', el: 'exit', cid: event.cid, ts: event.ts + 1 };\n        return event;\n    });\n    window.items = items;\n\n    var prev = countEvents(items.map(function (_ref12) {\n        var prev = _ref12.prev;\n        return prev;\n    }));\n    var next = countEvents(items.map(function (_ref13) {\n        var next = _ref13.next;\n        return next;\n    }));\n\n    if (document.getElementById('info')) {\n        document.getElementById('info').innerHTML = '<ul>\\n            <li>' + events.length + ' events (' + (events.length / totalClicks * 100).toFixed(2) + '%)</li>\\n            <li>' + users.length + ' users (' + (events.length / totalUsers * 100).toFixed(2) + '%)</li>\\n        </ul>';\n\n        document.getElementById('prev').innerHTML = '<details>\\n        <summary>prev (' + prev.length + ')</summary>\\n        <table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\\n            <caption>Prev events</caption>\\n            <thead>\\n                <tr>\\n                    <th>ea</th>\\n                    <th>count</th>\\n                    <th>users</th>\\n                </tr>\\n            <thead>\\n            <tbody>' + prev.map(function (_ref14) {\n            var ec = _ref14.ec,\n                ea = _ref14.ea,\n                labels = _ref14.labels,\n                count = _ref14.count,\n                users = _ref14.users;\n            return '<tr><td><details><summary>' + ea + ' <button onclick=\"clickly.demo.highlight(\\'' + ea + '\\')\">highlight</button><button onclick=\"clickly.demo.click(\\'' + ea + '\\')\">click</button></summary><small><ul>' + labels.map(function (x) {\n                return '<li>' + x.label + ' (' + x.count + ')</li>';\n            }) + '</ul><small></details></td><td>' + count + ' (' + (count / totalClicks * 100).toFixed(2) + '%)</td><td>' + users + ' (' + (users / totalUsers * 100).toFixed(2) + '%)</td></tr>';\n        }).join('') + '</tbody>\\n        </table>\\n        </details>';\n\n        document.getElementById('next').innerHTML = '<details>\\n        <summary>next (' + next.length + ')</summary>\\n        <table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\\n        <caption>Next events</caption>\\n        <thead>\\n            <tr>\\n                <th>ea</th>\\n                <th>count</th>\\n                <th>users</th>\\n            </tr>\\n        <thead>\\n        <tbody>' + prev.map(function (_ref15) {\n            var ec = _ref15.ec,\n                ea = _ref15.ea,\n                labels = _ref15.labels,\n                count = _ref15.count,\n                users = _ref15.users;\n            return '<tr><td><details><summary>' + ea + ' <button onclick=\"clickly.demo.highlight(\\'' + ea + '\\')\">highlight</button><button onclick=\"clickly.demo.click(\\'' + ea + '\\')\">click</button></summary><small><ul>' + labels.map(function (x) {\n                return '<li>' + x.label + ' (' + x.count + ')</li>';\n            }) + '</ul><small></details></td><td>' + count + ' (' + (count / totalClicks * 100).toFixed(2) + '%)</td><td>' + users + ' (' + (users / totalUsers * 100).toFixed(2) + '%)</td></tr>';\n        }).join('') + '</tbody>\\n        </table>\\n        </details>';\n    }\n};\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// clickly.demo.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7cf1d74031d6d0319326","export const getTrackingId = () => document.querySelector('script[data-clickly-tid]').getAttribute('data-clickly-tid')\n\nexport const getClientId = () => {\n    var value = window.document.cookie\n        .split(';')\n        .map(c => c.trim())\n        .find(c => c.indexOf('_ga=') === 0)\n    return value ? parseInt(value.replace(/_ga=GA\\d\\.\\d\\./, '').split('.').shift()) : null\n}\n\nexport const getDebug = () => !!localStorage.getItem('debug')\n\nexport const addDays = (date, days) => {\n    const result = new Date(date)\n    result.setDate(result.getDate() + days)\n    return result\n}\n\nexport const dateDaysAgo = days => addDays(new Date(), days)\n\nexport const dateToAnalyticsFormat = date => date.toISOString().split('T').shift()\n\nexport const dateFromAnalyticsFormat = str => new Date(str.replace(/(\\d{4})(\\d{2})(\\d{2})/, '$1-$2-$3'))\n\nconst buildQueryString = obj => Object.keys(obj).map(k => k + '=' + encodeURIComponent(obj[k])).join('&')\n\nconst getNodeSelectorString = node => node.tagName.toLowerCase() + (node.id ? '#' + node.id : '') + (!!node.className ? '.' + node.className.trim().replace(/\\s+/g, '.') : '')\n\nconst traverseUp = node => {\n    const items = []\n    do {\n        items.push(node)\n        node = node.parentNode\n    } while(node && ['html', 'body'].indexOf(node.tagName.toLowerCase()) === -1)\n    return items.reverse()\n}\n\nconst getNodeSelector = node => traverseUp(node).map(getNodeSelectorString).join(' > ')\n\nconst getNodeText = node => {\n    const txt = node && node.innerText.trim() || node.getAttribute('alt') || node.getAttribute('title') || node && node.value || ''\n    return txt.length > 250 ? txt.substring(0, 247) + '...' : txt\n}\n\nconst getPageType = () => {\n    if (window.location.pathname === '/') return 'home'\n    else if (document.querySelectorAll('.subcategoryName').length > 0) return 'category'\n    else if (document.querySelectorAll('.product-grid').length > 0 && window.location.pathname.split('/').length > 3) return 'products'\n    else if (document.querySelectorAll('input[name=\"product_id\"]').length > 0) return 'product'\n    else return 'other'\n}\n\nconst inIframe = () => {\n    try {\n        return window.self !== window.top;\n    } catch (e) {\n        return true;\n    }\n}\n\nexport const buildCollector = (tid, cid, debug) => event => {\n    const data = {\n        v: 1,\n        tid,\n        cid: cid || '',\n        t: 'event',\n        cd1: cid || '',\n        cd2: Date.now(),\n        cd3: Date.now() + '.' + Math.random().toString(36).substring(5),\n        cd4: getPageType(),\n        ec: window.location.toString(),\n        ea: event ? getNodeSelector(event.target) : 'view',\n        el: event ? getNodeText(event.target) : document.title\n    }\n\n    const url = 'https://www.google-analytics.com/collect?' + buildQueryString(data)\n\n    if (!inIframe()) {\n        if (navigator.sendBeacon) {\n            navigator.sendBeacon(url)\n        } else {\n            fetch(url)\n        }\n    }\n\n    if (debug) {\n        console.table([data])\n    }\n}\n\nexport const buildIFramerStylesheet = () => {\n    const style = document.createElement('style')\n    style.innerText = `\n    body.capture *:hover {outline: 2px solid blue}\n    .clicklyhighlight {outline: 2px solid red;box-shadow:inset 0 0 0 2px red}\n    `\n    return style\n}\n\nconst capturer = event => {\n    event.preventDefault()\n    event.stopPropagation()\n    if (event.type !== 'click') return\n    document.querySelectorAll('.clicklyhighlight').forEach(el => el.classList.remove('clicklyhighlight'))\n    const data = {\n        iframer: {\n            click: {\n                ec: window.location.toString(),\n                ea: getNodeSelector(event.target),\n                el: getNodeText(event.target),\n                cd4: getPageType()\n            }\n        }\n    }\n    parent.postMessage(data, '*')\n}\n\nexport const iframer = event => {\n    if (!event || !event.data) return\n    if (!event.data.hasOwnProperty('iframer')) return\n\n    const data = event.data.iframer\n\n    console.log('MESSAGE', data)\n\n    if (data.hasOwnProperty('mode')) {\n        if (data.mode === 'capture') {\n            document.body.classList.add('capture')\n            if (parent) {\n                parent.postMessage({\n                    iframer: {\n                        load: {\n                            url: window.location.toString(),\n                            cd4: getPageType()\n                        }\n                    }\n                }, '*')\n            }\n        } else {\n            document.body.classList.remove('capture')\n        }\n        const eventAction = data.mode === 'capture'\n            ? document.body.addEventListener\n            : document.body.removeEventListener\n\n        eventAction('mousedown', capturer, true)\n        eventAction('mouseup', capturer, true)\n        eventAction('click', capturer, true)\n    } else if (data.hasOwnProperty('highlight')) {\n        console.log(`going to highlight \"${data.highlight.ea}\" ${document.querySelectorAll(data.highlight.ea).length} element(s)`)\n        document.querySelectorAll('.clicklyhighlight').forEach(el => el.classList.remove('clicklyhighlight'))\n        document.querySelectorAll(data.highlight.ea).forEach(el => el.classList.add('clicklyhighlight'))\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","const isIframerEvent = event => event\n    && event.data\n    && event.data.iframer\n    && event.data.iframer.action\n\nexport const initMessageBroadcaster = () => window.addEventListener('message', event => {\n    if (!isIframerEvent(event)) return\n    document.querySelectorAll('frame').forEach(frame => {\n        return frame.contentWindow.postMessage(event.data, '*')\n    })\n}, false)\n\nexport const postMessage = (action, payload = null) => parent && parent.postMessage({\n    iframer: {\n        action,\n        payload\n    }\n}, '*')\n\nexport const onMessage = (action, cb) => window.addEventListener('message', event => {\n    if (!isIframerEvent(event)) return\n    if (event.data.iframer.action !== action) return\n    cb(event.data.iframer.payload)\n}, false)\n\nexport default {\n    postMessage,\n    onMessage\n}\n\n\n// WEBPACK FOOTER //\n// ./src/iframer.js","import {dateDaysAgo, dateToAnalyticsFormat, dateFromAnalyticsFormat} from './utils'\nimport iframer from './iframer'\n\nsetTimeout(() => {\niframer.postMessage('ping')\n}, 1000)\niframer.onMessage('pong', msg => {\n    console.log('NEW IFRAMER GOT pong MESSAGE', msg)\n})\n\nexport const viewId = '160451249'\n\nexport const retrieveEventsForPageType = (type = 'home') => new Promise((resolve, reject) => {\n    const daysAgo = 1\n    gapi.client.request({\n        path: '/v4/reports:batchGet',\n        root: 'https://analyticsreporting.googleapis.com/',\n        method: 'POST',\n        body: {\n            reportRequests: [{\n                pageSize: 10000,\n                viewId,\n                dateRanges: [{\n                    // startDate: dateToAnalyticsFormat(dateDaysAgo(-1 * daysAgo)),\n                    // endDate: dateToAnalyticsFormat(dateDaysAgo(-1 * daysAgo))\n                    startDate: dateToAnalyticsFormat(dateDaysAgo(-8)),\n                    endDate: dateToAnalyticsFormat(dateDaysAgo(0))\n                }],\n                metrics: [{\n                    expression: 'ga:totalEvents'\n                }],\n                dimensions: [\n                    {name: 'ga:eventCategory'},\n                    {name: 'ga:eventAction'},\n                    {name: 'ga:eventLabel'},\n                    {name: 'ga:dimension1'},\n                    {name: 'ga:dimension2'}\n                ],\n                filtersExpression: `ga:dimension4==${type};ga:deviceCategory==desktop`\n            }]\n    }}).then(response => {\n        const data = response.result.reports[0].data.rows\n            .map(row => ({\n                ec: row.dimensions[0],\n                ea: row.dimensions[1],\n                el: row.dimensions[2],\n                cid: parseInt(row.dimensions[3]),\n                ts: parseInt(row.dimensions[4])\n            }))\n            .filter(item => !isNaN(item.cid))\n            .sort((a, b) => a.ts - b.ts)\n\n        window.data = data\n        resolve(data)\n    }, reject);\n})\n\nexport const getLabelsFor = (data, {/*ec,*/ ea}) => data\n    .filter(item => /*item.ec === ec &&*/ item.ea === ea)\n    .map(item => item.el)\n    .reduce((acc, x) => {\n        if (acc.indexOf(x) === -1) {\n            acc.push(x)\n        }\n        return acc\n    }, [])\n    .map(label => ({\n        label,\n        count: data.filter(i => i.el === label).length\n    }))\n    .sort((a, b) => b.count - a.count)\n\nexport const getUsersFor = (data, {/*ec,*/ ea}) => data\n    .filter(item => /*item.ec === ec &&*/ item.ea === ea)\n    .map(item => item.cid)\n    .reduce((acc, x) => {\n        if (acc.indexOf(x) === -1) {\n            acc.push(x)\n        }\n        return acc\n    }, [])\n    .length\n\nexport const countEvents = data => {\n    const events = data\n        //.map(({ec, ea, el}) => ({ec, ea, el}))\n        //.map(({ec, ea}) => ({ec, ea}))\n        .map(({ea}) => ({ea}))\n        .reduce((acc, x) => {\n            const key = JSON.stringify(x)\n            acc[key] = (acc[key] || 0) + 1\n            return acc\n        }, {})\n    return Object.keys(events)\n        //.map(key => Object.assign(JSON.parse(key), {count: events[key]}))\n        .map(key => Object.assign(JSON.parse(key), {\n            count: events[key],\n            labels: getLabelsFor(data, JSON.parse(key)),\n            users: getUsersFor(data, JSON.parse(key))\n        }))\n        .sort((a, b) => b.count - a.count)\n}\n\nexport let totalUsers = 0\nexport let totalClicks = 0\n\nexport const handleResponseData = data => {\n    const firstAfterView = data\n        .filter(i => i.ea === 'view')\n        .map(c => data.filter(i => c.cid === i.cid && c.ts < i.ts).sort((a, b) => a.ts - b.ts).shift())\n\n    const lastAfterView = data\n        .filter(i => i.ea === 'view')\n        .map(c => data.filter(i => c.cid === i.cid && c.ts < i.ts).sort((a, b) => a.ts - b.ts).pop())\n        .filter(c => !!c)\n\n\n    const firstClicksAfterView = firstAfterView.filter(c => !!c)\n\n    totalUsers = data.map(i => i.cid).reduce((acc, x) => {\n        if (acc.indexOf(x) === -1) {\n            acc.push(x)\n        }\n        return acc\n    }, []).length\n\n    totalClicks = data.filter(i => i.ea !== 'view').length\n\n    if (document.getElementById('info')) {\n        document.getElementById('info').innerHTML = `<ul>\n            <li>${totalUsers} users</li>\n            <li>${data.length} events</li>\n            <li>${data.filter(i => i.ea === 'view').length} pageviews</li>\n            <li>${totalClicks} clickls</li>\n            <li>${firstClicksAfterView.length} first clicks</li>\n            <li>${firstAfterView.length - firstClicksAfterView.length} exits</li>\n        </ul>`\n    }\n\n    const events = countEvents(firstClicksAfterView)\n    const rows = events\n        .filter(({ea}) => ea !== 'view')\n        .slice(0, 10)\n        .map(({ea, labels, count, users}) => `<tr><td><details><summary>${ea} <button onclick=\"clickly.demo.highlight('${ea}')\">highlight</button><button onclick=\"clickly.demo.click('${ea}')\">click</button></summary><small><ul>${labels.map(x => `<li>${x.label} (${x.count})</li>`)}</ul><small></details></td><td>${count} (${(count/totalClicks*100).toFixed(2)}%)</td><td>${users} (${(users/totalUsers*100).toFixed(2)}%)</td></tr>`)\n        .join('')\n\n    const table = `<table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\n        <caption>Top first clicks after view</caption>\n        <thead>\n            <tr>\n                <th>ea</th>\n                <th>count</th>\n                <th>users</th>\n            </tr>\n        <thead>\n        <tbody>${rows}</tbody>\n    </table>`\n\n\n    const rows2 = countEvents(lastAfterView)\n        .filter(({ea}) => ea !== 'view')\n        .slice(0, 10)\n        .map(({ea, labels, count, users}) => `<tr><td><details><summary>${ea} <button onclick=\"clickly.demo.highlight('${ea}')\">highlight</button><button onclick=\"clickly.demo.click('${ea}')\">click</button></summary><small><ul>${labels.map(x => `<li>${x.label} (${x.count})</li>`)}</ul><small></details></td><td>${count} (${(count/totalClicks*100).toFixed(2)}%)</td><td>${users} (${(users/totalUsers*100).toFixed(2)}%)</td></tr>`)\n        .join('')\n\n    const table2 = `<table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\n        <caption>Top last clicks after view</caption>\n        <thead>\n            <tr>\n                <th>ea</th>\n                <th>count</th>\n                <th>users</th>\n            </tr>\n        <thead>\n        <tbody>${rows2}</tbody>\n    </table>`\n\n    if (document.getElementById('topevents')) {\n        document.getElementById('topevents').innerHTML = table + table2\n    }\n}\n\nexport const highlight = ea => {\n    const data = {\n        iframer: {\n            highlight: {\n                ea\n            }\n        }\n    }\n    parent.postMessage(data, '*')\n}\n\nexport const click = ea => {\n    handleClick(data, {ea})\n}\n\nexport const handleClick = (data, click) => {\n    const events = data.filter(({ea}) => ea.indexOf(click.ea) === 0)\n    const users = Object.values(events.map(({cid}) => cid).reduce((acc, x) => Object.assign(acc, {[x]: x}), {}))\n    const items = events.map(event => {\n        event.prev = data.filter(({cid, ts}) => event.cid === cid && event.ts > ts).sort((a, b) => a.ts - b.ts).pop() || {ec: 'exit', ea: 'exit', el: 'exit', cid: event.cid, ts: event.ts + 1}\n        event.next = data.filter(({cid, ts}) => event.cid === cid && event.ts < ts).sort((a, b) => a.ts - b.ts).shift() || {ec: 'exit', ea: 'exit', el: 'exit', cid: event.cid, ts: event.ts + 1}\n        return event\n    })\n    window.items = items\n\n    const prev = countEvents(items.map(({prev}) => prev))\n    const next = countEvents(items.map(({next}) => next))\n\n\n    if (document.getElementById('info')) {\n        document.getElementById('info').innerHTML = `<ul>\n            <li>${events.length} events (${(events.length / totalClicks * 100).toFixed(2)}%)</li>\n            <li>${users.length} users (${(events.length / totalUsers * 100).toFixed(2)}%)</li>\n        </ul>`\n\n        document.getElementById('prev').innerHTML = `<details>\n        <summary>prev (${prev.length})</summary>\n        <table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\n            <caption>Prev events</caption>\n            <thead>\n                <tr>\n                    <th>ea</th>\n                    <th>count</th>\n                    <th>users</th>\n                </tr>\n            <thead>\n            <tbody>${prev\n                .map(({ec, ea, labels, count, users}) => `<tr><td><details><summary>${ea} <button onclick=\"clickly.demo.highlight('${ea}')\">highlight</button><button onclick=\"clickly.demo.click('${ea}')\">click</button></summary><small><ul>${labels.map(x => `<li>${x.label} (${x.count})</li>`)}</ul><small></details></td><td>${count} (${(count/totalClicks*100).toFixed(2)}%)</td><td>${users} (${(users/totalUsers*100).toFixed(2)}%)</td></tr>`)\n                .join('')}</tbody>\n        </table>\n        </details>`\n\n        document.getElementById('next').innerHTML = `<details>\n        <summary>next (${next.length})</summary>\n        <table cellpadding=\"5\" cellspacing=\"0\" border=\"1\" style=\"font-size:80%\">\n        <caption>Next events</caption>\n        <thead>\n            <tr>\n                <th>ea</th>\n                <th>count</th>\n                <th>users</th>\n            </tr>\n        <thead>\n        <tbody>${prev\n            .map(({ec, ea, labels, count, users}) => `<tr><td><details><summary>${ea} <button onclick=\"clickly.demo.highlight('${ea}')\">highlight</button><button onclick=\"clickly.demo.click('${ea}')\">click</button></summary><small><ul>${labels.map(x => `<li>${x.label} (${x.count})</li>`)}</ul><small></details></td><td>${count} (${(count/totalClicks*100).toFixed(2)}%)</td><td>${users} (${(users/totalUsers*100).toFixed(2)}%)</td></tr>`)\n            .join('')}</tbody>\n        </table>\n        </details>`\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/demo.js"],"sourceRoot":""}