var clickly=clickly||{};clickly.demo=function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(e.getTrackingId=function(){return document.querySelector("script[data-clickly-tid]").getAttribute("data-clickly-tid")},e.getClientId=function(){var t=window.document.cookie.split(";").map(function(t){return t.trim()}).find(function(t){return 0===t.indexOf("_ga=")});return t?parseInt(t.replace(/_ga=GA\d\.\d\./,"").split(".").shift()):null},e.getDebug=function(){return!!localStorage.getItem("debug")},e.addDays=function(t,e){var n=new Date(t);return n.setDate(n.getDate()+e),n}),r=(e.dateDaysAgo=function(t){return i(new Date,t)},e.dateToAnalyticsFormat=function(t){return t.toISOString().split("T").shift()},e.dateFromAnalyticsFormat=function(t){return new Date(t.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"))},function(t){return Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}),o=function(t){return t.tagName.toLowerCase()+(t.id?"#"+t.id:"")+(t.className?"."+t.className.trim().replace(/\s+/g,"."):"")},l=function(t){var e=[];do{e.push(t),t=t.parentNode}while(t&&-1===["html","body"].indexOf(t.tagName.toLowerCase()));return e.reverse()},c=function(t){return l(t).map(o).join(" > ")},a=function(t){var e=t&&t.innerText.trim()||t.getAttribute("alt")||t.getAttribute("title")||t&&t.value||"";return e.length>250?e.substring(0,247)+"...":e},u=function(){return"/"===window.location.pathname?"home":document.querySelectorAll(".subcategoryName").length>0?"category":document.querySelectorAll(".product-grid").length>0&&window.location.pathname.split("/").length>3?"products":document.querySelectorAll('input[name="product_id"]').length>0?"product":"other"},s=function(){try{return window.self!==window.top}catch(t){return!0}},d=(e.buildCollector=function(t,e,n){return function(i){var o={v:1,tid:t,cid:e||"",t:"event",cd1:e||"",cd2:Date.now(),cd3:Date.now()+"."+Math.random().toString(36).substring(5),cd4:u(),ec:window.location.toString(),ea:i?c(i.target):"view",el:i?a(i.target):document.title},l="https://www.google-analytics.com/collect?"+r(o);s()||(navigator.sendBeacon?navigator.sendBeacon(l):fetch(l)),n&&console.table([o])}},e.buildIFramerStylesheet=function(){var t=document.createElement("style");return t.innerText="\n    body.capture *:hover {outline: 2px solid blue}\n    .clicklyhighlight {outline: 2px solid red;box-shadow:inset 0 0 0 2px red}\n    ",t},function(t){if(t.preventDefault(),t.stopPropagation(),"click"===t.type){document.querySelectorAll(".clicklyhighlight").forEach(function(t){return t.classList.remove("clicklyhighlight")});var e={iframer:{click:{ec:window.location.toString(),ea:c(t.target),el:a(t.target),cd4:u()}}};parent.postMessage(e,"*")}});e.iframer=function(t){if(t&&t.data&&t.data.hasOwnProperty("iframer")){var e=t.data.iframer;if(console.log("MESSAGE",e),e.hasOwnProperty("mode")){"capture"===e.mode?(document.body.classList.add("capture"),parent&&parent.postMessage({iframer:{load:{url:window.location.toString(),cd4:u()}}},"*")):document.body.classList.remove("capture");var n="capture"===e.mode?document.body.addEventListener:document.body.removeEventListener;n("mousedown",d,!0),n("mouseup",d,!0),n("click",d,!0)}else e.hasOwnProperty("highlight")&&(console.log('going to highlight "'+e.highlight.ea+'" '+document.querySelectorAll(e.highlight.ea).length+" element(s)"),document.querySelectorAll(".clicklyhighlight").forEach(function(t){return t.classList.remove("clicklyhighlight")}),document.querySelectorAll(e.highlight.ea).forEach(function(t){return t.classList.add("clicklyhighlight")}))}}},,function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Object.defineProperty(e,"__esModule",{value:!0}),e.handleClick=e.click=e.highlight=e.handleResponseData=e.totalClicks=e.totalUsers=e.countEvents=e.getUsersFor=e.getLabelsFor=e.retrieveEventsForPageType=e.viewId=void 0;var r=n(0),o=e.viewId="160451249",l=(e.retrieveEventsForPageType=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";return new Promise(function(e,n){gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",body:{reportRequests:[{pageSize:1e4,viewId:o,dateRanges:[{startDate:(0,r.dateToAnalyticsFormat)((0,r.dateDaysAgo)(-8)),endDate:(0,r.dateToAnalyticsFormat)((0,r.dateDaysAgo)(0))}],metrics:[{expression:"ga:totalEvents"}],dimensions:[{name:"ga:eventCategory"},{name:"ga:eventAction"},{name:"ga:eventLabel"},{name:"ga:dimension1"},{name:"ga:dimension2"}],filtersExpression:"ga:dimension4=="+t+";ga:deviceCategory==desktop"}]}}).then(function(t){var n=t.result.reports[0].data.rows.map(function(t){return{ec:t.dimensions[0],ea:t.dimensions[1],el:t.dimensions[2],cid:parseInt(t.dimensions[3]),ts:parseInt(t.dimensions[4])}}).filter(function(t){return!isNaN(t.cid)}).sort(function(t,e){return t.ts-e.ts});window.data=n,e(n)},n)})},e.getLabelsFor=function(t,e){var n=e.ea;return t.filter(function(t){return t.ea===n}).map(function(t){return t.el}).reduce(function(t,e){return-1===t.indexOf(e)&&t.push(e),t},[]).map(function(e){return{label:e,count:t.filter(function(t){return t.el===e}).length}}).sort(function(t,e){return e.count-t.count})}),c=e.getUsersFor=function(t,e){var n=e.ea;return t.filter(function(t){return t.ea===n}).map(function(t){return t.cid}).reduce(function(t,e){return-1===t.indexOf(e)&&t.push(e),t},[]).length},a=e.countEvents=function(t){var e=t.map(function(t){return{ea:t.ea}}).reduce(function(t,e){var n=JSON.stringify(e);return t[n]=(t[n]||0)+1,t},{});return Object.keys(e).map(function(n){return Object.assign(JSON.parse(n),{count:e[n],labels:l(t,JSON.parse(n)),users:c(t,JSON.parse(n))})}).sort(function(t,e){return e.count-t.count})},u=e.totalUsers=0,s=e.totalClicks=0,d=(e.handleResponseData=function(t){var n=t.filter(function(t){return"view"===t.ea}).map(function(e){return t.filter(function(t){return e.cid===t.cid&&e.ts<t.ts}).sort(function(t,e){return t.ts-e.ts}).shift()}),i=t.filter(function(t){return"view"===t.ea}).map(function(e){return t.filter(function(t){return e.cid===t.cid&&e.ts<t.ts}).sort(function(t,e){return t.ts-e.ts}).pop()}).filter(function(t){return!!t}),r=n.filter(function(t){return!!t});e.totalUsers=u=t.map(function(t){return t.cid}).reduce(function(t,e){return-1===t.indexOf(e)&&t.push(e),t},[]).length,e.totalClicks=s=t.filter(function(t){return"view"!==t.ea}).length,document.getElementById("info")&&(document.getElementById("info").innerHTML="<ul>\n            <li>"+u+" users</li>\n            <li>"+t.length+" events</li>\n            <li>"+t.filter(function(t){return"view"===t.ea}).length+" pageviews</li>\n            <li>"+s+" clickls</li>\n            <li>"+r.length+" first clicks</li>\n            <li>"+(n.length-r.length)+" exits</li>\n        </ul>");var o=a(r),l=o.filter(function(t){return"view"!==t.ea}).slice(0,10).map(function(t){var e=t.ea,n=t.labels,i=t.count,r=t.users;return"<tr><td><details><summary>"+e+" <button onclick=\"clickly.demo.highlight('"+e+"')\">highlight</button><button onclick=\"clickly.demo.click('"+e+"')\">click</button></summary><small><ul>"+n.map(function(t){return"<li>"+t.label+" ("+t.count+")</li>"})+"</ul><small></details></td><td>"+i+" ("+(i/s*100).toFixed(2)+"%)</td><td>"+r+" ("+(r/u*100).toFixed(2)+"%)</td></tr>"}).join(""),c='<table cellpadding="5" cellspacing="0" border="1" style="font-size:80%">\n        <caption>Top first clicks after view</caption>\n        <thead>\n            <tr>\n                <th>ea</th>\n                <th>count</th>\n                <th>users</th>\n            </tr>\n        <thead>\n        <tbody>'+l+"</tbody>\n    </table>",d=a(i).filter(function(t){return"view"!==t.ea}).slice(0,10).map(function(t){var e=t.ea,n=t.labels,i=t.count,r=t.users;return"<tr><td><details><summary>"+e+" <button onclick=\"clickly.demo.highlight('"+e+"')\">highlight</button><button onclick=\"clickly.demo.click('"+e+"')\">click</button></summary><small><ul>"+n.map(function(t){return"<li>"+t.label+" ("+t.count+")</li>"})+"</ul><small></details></td><td>"+i+" ("+(i/s*100).toFixed(2)+"%)</td><td>"+r+" ("+(r/u*100).toFixed(2)+"%)</td></tr>"}).join(""),f='<table cellpadding="5" cellspacing="0" border="1" style="font-size:80%">\n        <caption>Top last clicks after view</caption>\n        <thead>\n            <tr>\n                <th>ea</th>\n                <th>count</th>\n                <th>users</th>\n            </tr>\n        <thead>\n        <tbody>'+d+"</tbody>\n    </table>";document.getElementById("topevents")&&(document.getElementById("topevents").innerHTML=c+f)},e.highlight=function(t){var e={iframer:{highlight:{ea:t}}};parent.postMessage(e,"*")},e.click=function(t){d(data,{ea:t})},e.handleClick=function(t,e){var n=t.filter(function(t){return 0===t.ea.indexOf(e.ea)}),r=Object.values(n.map(function(t){return t.cid}).reduce(function(t,e){return Object.assign(t,i({},e,e))},{})),o=n.map(function(e){return e.prev=t.filter(function(t){var n=t.cid,i=t.ts;return e.cid===n&&e.ts>i}).sort(function(t,e){return t.ts-e.ts}).pop()||{ec:"exit",ea:"exit",el:"exit",cid:e.cid,ts:e.ts+1},e.next=t.filter(function(t){var n=t.cid,i=t.ts;return e.cid===n&&e.ts<i}).sort(function(t,e){return t.ts-e.ts}).shift()||{ec:"exit",ea:"exit",el:"exit",cid:e.cid,ts:e.ts+1},e});window.items=o;var l=a(o.map(function(t){return t.prev})),c=a(o.map(function(t){return t.next}));document.getElementById("info")&&(document.getElementById("info").innerHTML="<ul>\n            <li>"+n.length+" events ("+(n.length/s*100).toFixed(2)+"%)</li>\n            <li>"+r.length+" users ("+(n.length/u*100).toFixed(2)+"%)</li>\n        </ul>",document.getElementById("prev").innerHTML="<details>\n        <summary>prev ("+l.length+')</summary>\n        <table cellpadding="5" cellspacing="0" border="1" style="font-size:80%">\n            <caption>Prev events</caption>\n            <thead>\n                <tr>\n                    <th>ea</th>\n                    <th>count</th>\n                    <th>users</th>\n                </tr>\n            <thead>\n            <tbody>'+l.map(function(t){var e=(t.ec,t.ea),n=t.labels,i=t.count,r=t.users;return"<tr><td><details><summary>"+e+" <button onclick=\"clickly.demo.highlight('"+e+"')\">highlight</button><button onclick=\"clickly.demo.click('"+e+"')\">click</button></summary><small><ul>"+n.map(function(t){return"<li>"+t.label+" ("+t.count+")</li>"})+"</ul><small></details></td><td>"+i+" ("+(i/s*100).toFixed(2)+"%)</td><td>"+r+" ("+(r/u*100).toFixed(2)+"%)</td></tr>"}).join("")+"</tbody>\n        </table>\n        </details>",document.getElementById("next").innerHTML="<details>\n        <summary>next ("+c.length+')</summary>\n        <table cellpadding="5" cellspacing="0" border="1" style="font-size:80%">\n        <caption>Next events</caption>\n        <thead>\n            <tr>\n                <th>ea</th>\n                <th>count</th>\n                <th>users</th>\n            </tr>\n        <thead>\n        <tbody>'+l.map(function(t){var e=(t.ec,t.ea),n=t.labels,i=t.count,r=t.users;return"<tr><td><details><summary>"+e+" <button onclick=\"clickly.demo.highlight('"+e+"')\">highlight</button><button onclick=\"clickly.demo.click('"+e+"')\">click</button></summary><small><ul>"+n.map(function(t){return"<li>"+t.label+" ("+t.count+")</li>"})+"</ul><small></details></td><td>"+i+" ("+(i/s*100).toFixed(2)+"%)</td><td>"+r+" ("+(r/u*100).toFixed(2)+"%)</td></tr>"}).join("")+"</tbody>\n        </table>\n        </details>")})}]);
//# sourceMappingURL=clickly.demo.js.map